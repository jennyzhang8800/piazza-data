{"aid": "igkpcdzlmx96da", "error": null, "result": {"default_anonymity": "no", "status": "active", "i_edits": [], "q_edits": [], "bookmarked": 8, "request_instructor": 0, "history": [{"uid": "hs2sszxmgag6jq", "anon": "no", "created": "2015-04-07T08:03:33Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"uid": "hs2sszxmgag6jq", "anon": "no", "created": "2015-04-07T07:45:06Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>\n#pin", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"uid": "i6un8w0cKfP", "anon": "no", "created": "2015-03-31T13:50:26Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}, {"uid": "i6un8w0cKfP", "anon": "no", "created": "2015-03-31T13:26:43Z", "content": "<p>如题所问 搜索未果</p>", "subject": "iret在什么情况下会把%gs变成0&#xff1f;"}], "s_edits": [], "is_bookmarked": false, "tag_good_arr": [], "request_instructor_me": false, "my_favorite": false, "t": 1446635363025, "children": [{"is_tag_endorse": false, "created": "2015-03-31T13:58:43Z", "id": "i7xdegb3ywa30s", "tag_endorse": [], "folders": [], "history": [{"anon": "full", "created": "2015-03-31T14:13:33Z", "content": "<p></p>", "subject": ""}, {"uid": "i6un8w0cKfP", "anon": "no", "created": "2015-03-31T14:09:52Z", "content": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>", "subject": ""}, {"uid": "i6un8w0cKfP", "anon": "no", "created": "2015-03-31T13:59:01Z", "content": "<p>然后我发现了这个</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>", "subject": ""}, {"uid": "i6un8w0cKfP", "anon": "no", "created": "2015-03-31T13:58:43Z", "content": "<p>然后我发现了这个</p>\n<p>http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</p>", "subject": ""}], "config": {}, "data": {"embed_links": []}, "bucket_order": 2, "bucket_name": "Today", "tag_endorse_arr": [], "children": [], "type": "s_answer"}, {"no_answer": 0, "created": "2015-03-31T14:13:51Z", "id": "i7xdxx0qux81tt", "updated": "2015-03-31T14:13:51Z", "subject": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\"></a></p>\n<p>似乎确实是会清的</p>\n<p>我仍然不明白它闲着没事清俩寄存器有什么作用</p>", "anon": "full", "folders": [], "config": {}, "data": {"embed_links": null}, "bucket_order": 5, "bucket_name": "Last week", "no_upvotes": 0, "children": [], "type": "followup"}, {"uid": "i6uqzf449em3ex", "no_answer": 0, "created": "2015-03-31T17:40:25Z", "id": "i7xlbkn6r153ht", "updated": "2015-03-31T17:40:25Z", "subject": "<p>不是iret清零的吧&#xff0c;是那个popl %gs吧&#xff1f;</p>", "anon": "no", "folders": [], "config": {}, "data": {"embed_links": null}, "bucket_order": 5, "bucket_name": "Last week", "no_upvotes": 0, "children": [{"created": "2015-04-01T12:54:07Z", "id": "i7yqj8pwgfnow", "updated": "2015-04-01T12:54:07Z", "subject": "<p>确实是iret清的 我以为设了tf_gs就没事了 结果调死我了 单步了一晚上才发现</p>", "anon": "full", "folders": [], "config": {}, "data": {"embed_links": null}, "bucket_order": 5, "bucket_name": "Last week", "children": [], "type": "feedback"}, {"uid": "i6un8w0cKfP", "created": "2015-04-01T13:01:11Z", "id": "i7yqsbk62jlwk", "updated": "2015-04-01T13:01:11Z", "subject": "<p>不小心匿名了。。</p>\n<p>前面那个pop %gs带有强烈的误导性&#xff0c;一个会被iret修改的东西不需要push再pop&#xff0c;所以我根本没怀疑过iret会动这玩意。现在看来是qemu写错了&#xff0c;气死我了。。</p>", "anon": "no", "folders": [], "config": {}, "data": {"embed_links": null}, "bucket_order": 5, "bucket_name": "Last week", "children": [], "type": "feedback"}], "type": "followup"}, {"uid": "hcrrjuyequh4bt", "no_answer": 0, "created": "2015-04-01T01:32:23Z", "id": "i7y26ik8ewsbh", "updated": "2015-04-01T01:32:23Z", "subject": "<p>iret 会根据 kernel stack返回到内核空间和用户空间&#xff0c;并修改部分寄存器&#xff0c;但不包括GS.</p>\n<p>你在哪段代码调试中发现了这个问题?</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p>你的qemu的版本是?</p>", "anon": "no", "folders": [], "config": {}, "data": {"embed_links": null}, "bucket_order": 5, "bucket_name": "Last week", "no_upvotes": 0, "children": [{"uid": "i6un8w0cKfP", "created": "2015-04-01T13:00:35Z", "id": "i7yqrk1k9ymgg", "updated": "2015-04-01T13:00:35Z", "subject": "<p>你在哪段代码调试中发现了这个问题?</p>\n<p>我在iret回用户程序之后会莫名其妙的崩溃&#xff0c;经过调试发现&#xff05;gs变成0了&#xff0c;单步后发现被iret清了&#xff0c;只有在ring0到3外加一些条件才会发生。</p>\n<p>我原以为iret不会修改gs&#xff0c;用户程序也不能修改段寄存器&#xff0c;所以直接在trapframe中设定gs&#xff0c;以为这个量可以留住。</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p><a href=\"https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038\">https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038</a></p>\n<p>断点设定在trapentry.S的trapret&#xff0c;pop %gs后查看gs正常&#xff0c;iret执行后立刻变成0。</p>\n<div>\n<div>\n<p>你的qemu的版本是?</p>\n</div>\n</div>\n<div>\n<div>\n<div>\n<div>QEMU emulator version 2.1.0 (Debian 2.1&#43;dfsg-4ubuntu6.4), Copyright (c) 2003-2008 Fabrice Bellard</div>\n</div>\n</div>\n</div>", "anon": "no", "folders": [], "config": {}, "data": {"embed_links": null}, "bucket_order": 5, "bucket_name": "Last week", "children": [], "type": "feedback"}], "type": "followup"}, {"is_tag_endorse": false, "created": "2015-04-01T02:38:41Z", "id": "i7y4jrv8w0r2ls", "tag_endorse": [], "folders": [], "history": [{"uid": "hsfa0sawctb6v4", "anon": "no", "created": "2015-04-01T03:04:34Z", "content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>\n<p></p>\n<p>把GS所指的描述符的DPL设成3&#xff0c;应该就没有问题了</p>", "subject": ""}, {"uid": "hdjoucuyb836fq", "anon": "no", "created": "2015-04-01T02:59:32Z", "content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>", "subject": ""}, {"uid": "hdjoucuyb836fq", "anon": "no", "created": "2015-04-01T02:58:21Z", "content": "<p>这个是qemu的行为&#xff0c;在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>", "subject": ""}, {"uid": "hdjoucuyb836fq", "anon": "no", "created": "2015-04-01T02:38:41Z", "content": "<p>请试一下把gs对应段的权限从USER_DS改成KERNEL_DS。</p>", "subject": ""}], "config": {}, "data": {"embed_links": []}, "bucket_order": 2, "bucket_name": "Today", "tag_endorse_arr": [], "children": [], "type": "i_answer"}], "type": "question", "unique_views": 64, "created": "2015-03-31T13:26:43Z", "id": "i7xc9ashjl65xt", "no_answer": 0, "nr": 218, "data": {"embed_links": []}, "upvote_ids": [], "is_tag_good": false, "config": {}, "folders": ["big_proj"], "bucket_order": 2, "change_log": [{"uid": "i6un8w0cKfP", "when": "2015-03-31T13:26:43Z", "data": "i7xc9asjqvy5xu", "anon": "no", "type": "create"}, {"uid": "i6un8w0cKfP", "when": "2015-03-31T13:50:26Z", "data": "i7xd3sw6qcx7nk", "anon": "no", "type": "update"}, {"uid": "i6un8w0cKfP", "when": "2015-03-31T13:58:43Z", "data": "i7xdegcyg2x30t", "to": "i7xc9ashjl65xt", "anon": "no", "type": "s_answer"}, {"uid": "i6un8w0cKfP", "when": "2015-03-31T13:59:01Z", "data": "i7xdeu4pn7f365", "anon": "no", "type": "s_answer_update"}, {"uid": "i6un8w0cKfP", "when": "2015-03-31T14:09:52Z", "data": "i7xdssxqe846ef", "anon": "no", "type": "s_answer_update"}, {"when": "2015-03-31T14:13:33Z", "data": "i7xdxjm467onk", "anon": "full", "type": "s_answer_update"}, {"when": "2015-03-31T14:13:51Z", "to": "i7xc9ashjl65xt", "anon": "full", "type": "followup"}, {"uid": "i6uqzf449em3ex", "when": "2015-03-31T17:40:25Z", "to": "i7xc9ashjl65xt", "anon": "no", "type": "followup"}, {"uid": "hcrrjuyequh4bt", "when": "2015-04-01T01:32:23Z", "to": "i7xc9ashjl65xt", "anon": "no", "type": "followup"}, {"uid": "hdjoucuyb836fq", "when": "2015-04-01T02:38:41Z", "data": "i7y4jrvayk82lt", "to": "i7xc9ashjl65xt", "anon": "no", "type": "i_answer"}, {"uid": "hdjoucuyb836fq", "when": "2015-04-01T02:58:21Z", "data": "i7y592ghm2b3o7", "anon": "no", "type": "i_answer_update"}, {"uid": "hdjoucuyb836fq", "when": "2015-04-01T02:59:32Z", "data": "i7y5alkw5kf1mk", "anon": "no", "type": "i_answer_update"}, {"uid": "hsfa0sawctb6v4", "when": "2015-04-01T03:04:34Z", "data": "i7y5h2dktlb1ub", "anon": "no", "type": "i_answer_update"}, {"when": "2015-04-01T12:54:07Z", "to": "i7xc9ashjl65xt", "anon": "full", "type": "feedback"}, {"uid": "i6un8w0cKfP", "when": "2015-04-01T13:00:35Z", "to": "i7xc9ashjl65xt", "anon": "no", "type": "feedback"}, {"uid": "i6un8w0cKfP", "when": "2015-04-01T13:01:11Z", "to": "i7xc9ashjl65xt", "anon": "no", "type": "feedback"}, {"uid": "hs2sszxmgag6jq", "when": "2015-04-07T07:45:06Z", "data": "i8704yh3who51q", "anon": "no", "type": "update"}, {"uid": "hs2sszxmgag6jq", "when": "2015-04-07T08:03:33Z", "data": "i870so8truy2do", "anon": "no", "type": "update"}], "bucket_name": "Today", "tags": ["big_proj", "student"], "no_answer_followup": 0, "num_favorites": 0, "tag_good": []}}